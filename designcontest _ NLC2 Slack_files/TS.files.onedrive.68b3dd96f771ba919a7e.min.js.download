webpackJsonp([410],{3872:function(e,r){(function(){"use strict";TS.registerModule("files.onedrive",{onStart:function e(){if(!TS.client)return;TS.files.team_file_shared_sig.add(l)},openPickerWindow:function a(){var s=null;return new Promise(function(t,n){$("<iframe>",{src:e,id:"onedrive_picker_iframe"}).appendTo("body").hide();s=i(t,n);window.addEventListener("message",s);if(r){n("Promise already made")}r=true}).then(function(e){r=false;return o(e.chosen_files,TS.shared.getActiveModelOb())}).catch(function(e){if(e==="Promise already made"){return}var i=t;TS.error(e);if((e.data.error==="unidentified_external_url"||e.data.error==="file_type_has_no_handler")&&e.args.link){i=TS.i18n.t("We don’t currently support importing that type of OneDrive file, but we included the link so that others can access it.","files")()}if(e.data.error==="filename_too_long"){i=n}TS.client.ui.addEphemeralBotMsg({text:i,ephemeral_type:"file_type_has_no_handler",slackbot_feels:"sad_surprise"});r=false}).finally(function(){$("#onedrive_picker_iframe").remove();window.removeEventListener("message",s)})}});var e=TS.boot_data.team_url+"files/import/onedrive";var r=false;var t=TS.i18n.t("Darn, that didn’t work. Try again or <https://my.slack.com/help/requests/new|contact us> if it’s still not working.","files")();var n=TS.i18n.t("Sorry! The name of that file is too long for us to handle. Please try importing a file with a shorter filename.","files")();var i=function e(r,t){return a({resolve:r,reject:t,method:"onedrive_picker"})};var a=function e(r){return function(e){if(e.data.method!==r.method)return;if(!e.data.ok){r.reject(new Error(r.method+" not ok"))}else{r.resolve(e.data)}}};var o=function e(r,t){var n=r.map(function(e){return s(e,t)});return Promise.all(n)};var s=function e(r,t){return TS.api.call("files.uploadExternal",{channels:t.id,link:r}).then(function(e){TS.log(9999,"TODO");TS.log(9999,e)})};var l=function e(r){if(_.get(r,"external_type")!=="onedrive")return;if(_.get(r,"user")!==TS.model.user.id)return;if(!TS.model.team.prefs.onedrive_enabled_team)return;if(TS.model.prefs.seen_onedrive_coachmark)return;TS.coachmark.start(TS.coachmarks.coachmarks.onedrive);TS.model.prefs.seen_onedrive_coachmark=true;TS.prefs.setPrefByAPI({name:"seen_onedrive_coachmark",value:true})}})()}},[3872]);